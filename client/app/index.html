<!DOCTYPE html>
<html>
<head>
  <title>Lunch Translator</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body ng-app="myApp" ng-controller="translationController">

  <div class="container">

    <div class="row">
      <h2>Translations</h2>
    </div>

    <div class="row">
      <div class="pull-left">
      <em>all search strings are case-insensitive regular expressions</em>
      </div>
      <div class="pull-right">
        <a href="#" role="button" class="btn btn-success" data-toggle="modal" data-target="#editModal" ng-click="edit();"><i class="fa fa-plus-circle fa-fw"></i>New Translation</a>
      </div>
    </div>

    <div class="row">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Search String</th>
            <th>Replacement String</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="translation in translations | orderBy: 'target'">
            <td>{{ translation.target }}</td>
            <td>{{ translation.replacement }}</td>
            <td>
              <span class="pull-right">
                <a href="#" role="button" class="btn btn-primary" data-toggle="modal" data-target="#editModal" ng-click="edit(translation._id)"><i class="fa fa-pencil fa-fw"></i>Edit</a>
                <a href="#" role="button" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal" ng-click="edit(translation._id)"><i class="fa fa-remove fa-fw"></i>Delete</a>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="modal" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="editModalLabel">Edit Translation</h4>
          </div>
          <div class="modal-body">
            <form>
              <input type="hidden" ng-model="_id"/>
              <div class="form-group">
                <label for="searchInput">Search String:</label>
                <input type="text" ng-model="target" id="searchInput" placeholder="mushrooms" class="form-control"/>
              </div>
              <div class="form-group">
                <label for="replacementInput">Replacement String:</label>
                <input type="text" ng-model="replacement" id="replacementInput" placeholder="fungus" class="form-control"/>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-ban fa-fw"></i>Cancel</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="save();"><i class="fa fa-save fa-fw"></i>Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="deleteModalLabel">Delete Translation</h4>
          </div>
          <div class="modal-body">
            Are you sure you want to delete the translation for "{{ target }}" ?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-ban fa-fw"></i>Cancel</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal" ng-click="delete(_id);"><i class="fa fa-remove fa-fw"></i>Delete</a>
          </div>
        </div>
      </div>
    </div>

  </div>

</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script type="text/javascript">
angular.module('myApp', []).controller('translationController', function($scope,$http) {

  $scope.edit = function(id) {
      if (id) {
        $http.get('translations/' + id).success(
          function(response) {
            $scope._id = response[0]._id;
            $scope.target = response[0].target;
            $scope.replacement = response[0].replacement;
          });
      } else {
        $scope._id = null;
        $scope.target = '';
        $scope.replacement = '';
      }
  };

  $scope.save = function() {
    var verb;
    var url = 'translations';

    if ($scope._id) {
      verb = 'PUT';
      url = url + '/' + $scope._id
    }
    else {
      verb = 'POST';
    }

    $http({
      url: url,
      method: verb,
      data: {
        target: $scope.target,
        replacement: $scope.replacement
       }
    }).success(
      function(data, status, headers, config){
        $scope.refresh();
      }
    );
  };

  $scope.delete = function(id) {
    $http.delete('translations/' + id).success(
      function(data, status, headers, config) {
        $scope.refresh();
      });
  };

  $scope.refresh = function() {
    $http.get('translations').success(
      function(data, status, headers, config) {
        $scope.translations = data;
      });
  };

  $scope.refresh();
});
</script>

</html>
