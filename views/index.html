{% raw %}
<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
</head>

<body ng-app="myApp" ng-controller="translationController">
  <div class="container">

    <h2>Translations</h2>

    <div class="row">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Search String</th>
            <th>Replacement String</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="translation in translations">
            <td>{{ translation.target }}</td>
            <td>{{ translation.replacement }}</td>
            <td>
              <a href="#" role="button" class="btn btn-primary" ng-click="edit(translation._id)"><i class="fa fa-pencil fa-fw"></i>Edit</a>
              <a href="#" role="button" class="btn btn-danger" ng-click="delete(translation._id)"><i class="fa fa-remove fa-fw"></i>Delete</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="row">
      all search strings are case-insensitive regular expressions<br/><br/>
      <a href="#" role="button" class="btn btn-success" ng-click="edit();"><i class="fa fa-plus-circle fa-fw"></i>New Translation</a>
    </div>

    <div class="row" ng-hide="!isEditing">
      <form>
        <input type="hidden" ng-model="_id"/>
        <div class="form-group">
          <label class="control-label">Search String:</label>
          <input type="text" ng-model="target"/>
        </div>
        <div class="form-group">
          <label class="control-label">Replacement String:</label>
          <input type="text" ng-model="replacement"/>
        </div>
        <a href="#" role="button" class="btn btn-success" ng-click="save();"><i class="fa fa-save fa-fw"></i>Save</a>
        <a href="#" role="button" class="btn btn-primary" ng-click="cancel();"><i class="fa fa-ban fa-fw"></i>Cancel</a>
      </form>
    </div>

  </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
<script type="text/javascript">
angular.module('myApp', []).controller('translationController', function($scope,$http) {
  $scope.isEditing = false;

  $scope.edit = function(id) {
      if (id) {
        $http.get('translations/' + id).success(
          function(response) {
            $scope._id = response[0]._id;
            $scope.target = response[0].target;
            $scope.replacement = response[0].replacement;
            $scope.isEditing = true;
          });
      } else {
        $scope._id = null;
        $scope.target = '';
        $scope.replacement = '';
        $scope.isEditing = true;
      }
  };

  $scope.save = function() {
    var verb;
    var url = 'translations';

    if ($scope._id) {
      verb = 'PUT';
      url = url + '/' + $scope._id
    }
    else {
      verb = 'POST';
    }

    $http({
      url: url,
      method: verb,
      data: {
        target: $scope.target,
        replacement: $scope.replacement
       }
    }).success(
      function(data, status, headers, config){
        $scope.isEditing = false;
        $scope.refresh();
      }
    );
  };

  $scope.cancel = function() {
    $scope.isEditing = false;
  };

  $scope.delete = function(id) {
    if (confirm('Are you sure?')) {
      $scope.isEditing = false;
      $http.delete('translations/' + id).success(
        function(data, status, headers, config) {
          $scope.refresh();
        });
    }
  };

  $scope.refresh = function() {
    $http.get('translations').success(
      function(data, status, headers, config) {
        $scope.translations = data;
      });
  };

  $scope.refresh();
});
</script>

</html>
{% endraw %}
